{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Gis/geotech/actions/locations.action.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport prisma from \"@/lib/prisma\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { point } from \"@turf/helpers\";\r\nimport booleanPointInPolygon from \"@turf/boolean-point-in-polygon\";\r\n\r\nexport async function createLocation(data: FormData) {\r\n  try {\r\n    // Create new user location\r\n    const location = await prisma.userLocation.create({\r\n      data: {\r\n        name: data.get(\"name\") as string,\r\n        description: data.get(\"description\") as string,\r\n        latitude: parseFloat(data.get(\"latitude\") as string),\r\n        longitude: parseFloat(data.get(\"longitude\") as string),\r\n        userId: parseInt(data.get(\"userId\") as string, 10),\r\n      },\r\n    });\r\n\r\n    // ✅ Find all ACTIVE zones\r\n    const activeZones = await prisma.zone.findMany({\r\n      where: { status: \"ACTIVE\" },\r\n      select: { id: true, geoJson: true },\r\n    });\r\n\r\n    const locPoint = point([location.longitude, location.latitude]);\r\n    const affectedZones: { zoneId: number; userLocationId: number }[] = [];\r\n\r\n    // ✅ Check if the location falls inside any active zone\r\n    activeZones.forEach((zone) => {\r\n      if (booleanPointInPolygon(locPoint, zone.geoJson as any)) {\r\n        affectedZones.push({\r\n          zoneId: zone.id,\r\n          userLocationId: location.id,\r\n        });\r\n      }\r\n    });\r\n\r\n    // ✅ If affected, record the associations\r\n    if (affectedZones.length > 0) {\r\n      await prisma.affectedUserLocation.createMany({\r\n        data: affectedZones,\r\n      });\r\n    }\r\n\r\n    return location;\r\n  } catch (error) {\r\n    console.error(error);\r\n    throw new Error(\"Failed to create location\");\r\n  }\r\n}\r\n\r\nexport async function updateLocation(id: string, formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const description = formData.get(\"description\") as string;\r\n  const latitude = parseFloat(formData.get(\"latitude\") as string);\r\n  const longitude = parseFloat(formData.get(\"longitude\") as string);\r\n\r\n  try {\r\n    // ✅ Update the user location\r\n    const location = await prisma.userLocation.update({\r\n      where: { id: parseInt(id) },\r\n      data: {\r\n        name,\r\n        description,\r\n        latitude,\r\n        longitude,\r\n      },\r\n    });\r\n\r\n    // ✅ Delete old affected zone associations (in case location moved)\r\n    await prisma.affectedUserLocation.deleteMany({\r\n      where: { userLocationId: location.id },\r\n    });\r\n\r\n    // ✅ Find all ACTIVE zones\r\n    const activeZones = await prisma.zone.findMany({\r\n      where: { status: \"ACTIVE\" },\r\n      select: { id: true, geoJson: true },\r\n    });\r\n\r\n    const locPoint = point([location.longitude, location.latitude]);\r\n    const affectedZones: { zoneId: number; userLocationId: number }[] = [];\r\n\r\n    // ✅ Check if updated location falls inside active zones\r\n    activeZones.forEach((zone) => {\r\n      if (booleanPointInPolygon(locPoint, zone.geoJson as any)) {\r\n        affectedZones.push({\r\n          zoneId: zone.id,\r\n          userLocationId: location.id,\r\n        });\r\n      }\r\n    });\r\n\r\n    // ✅ If affected, recreate associations\r\n    if (affectedZones.length > 0) {\r\n      await prisma.affectedUserLocation.createMany({\r\n        data: affectedZones,\r\n      });\r\n    }\r\n\r\n    return location;\r\n  } catch (error) {\r\n    console.error(\"Error updating location:\", error);\r\n    throw new Error(\"Failed to update location\");\r\n  }\r\n}\r\n\r\nexport async function getUserLocations(userId: number) {\r\n  try {\r\n    return await prisma.userLocation.findMany({\r\n      where: { userId },\r\n      include: {\r\n        affectedUserLocations: {\r\n          where: {\r\n            zone: {\r\n              status: \"ACTIVE\",\r\n            },\r\n          },\r\n          include: { zone: true },\r\n        },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new Error(\"Error\");\r\n  }\r\n}\r\n\r\nexport async function deleteUserLocation(locationId: number) {\r\n  try {\r\n    await prisma.userLocation.delete({ where: { id: locationId } });\r\n    revalidatePath(\"/\");\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n}\r\n\r\nexport async function getUserLocation(locationId: number) {\r\n  try {\r\n    return await prisma.userLocation.findUnique({ where: { id: locationId } });\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new Error(\"Error\");\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///D:/Gis/geotech/.next-internal/server/app/%28dashboard%29/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getUserLocations as '40b8dbc0e9ba96ec038fd93ec7ef49be70c2139441'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 229, "column": 0}, "map": {"version":3,"sources":["file:///D:/Gis/geotech/app/%28dashboard%29/dashboard/Weather.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(dashboard)/dashboard/Weather.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(dashboard)/dashboard/Weather.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///D:/Gis/geotech/app/%28dashboard%29/dashboard/Weather.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(dashboard)/dashboard/Weather.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(dashboard)/dashboard/Weather.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAqR,GAClT,mDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 265, "column": 0}, "map": {"version":3,"sources":["file:///D:/Gis/geotech/app/%28dashboard%29/dashboard/page.tsx"],"sourcesContent":["import { auth } from \"@/auth\";\r\nimport WeatherDashboard from \"./Weather\";\r\n\r\nexport default async function DashboardPage() {\r\n  const session = await auth();\r\n\r\n  if (!session) return;\r\n\r\n  return <WeatherDashboard userId={session.user.id} />;\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,4GAAI;IAE1B,IAAI,CAAC,SAAS;IAEd,qBAAO,8OAAC,wJAAgB;QAAC,QAAQ,QAAQ,IAAI,CAAC,EAAE;;;;;;AAClD","debugId":null}}]
}